parameters:
  serviceConnection: ''
  terraformstoragerg: ''
  terraformstorageaccount: ''
  location: ''

steps:
- task: AzureCLI@1
  inputs:
    azureSubscription: ${{ parameters.serviceConnection }}
    arguments: ${{ parameters.terraformstorageaccount }} ${{ parameters.terraformstoragerg }} ${{ parameters.location }}
    scriptLocation: 'inlineScript'
    inlineScript: |
      az storage container create --name terraform --account-name $1
      STORAGEKEY=$(az storage account keys list --resource-group $2 --account-name $1 --query "[0].value" | tr -d '"')

- script: |      
    echo "##vso[task.setvariable variable=storagekey;isOutput=true]$STORAGEKEY"
  displayName: PrepareContainer
  name: prepareContainer
