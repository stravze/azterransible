parameters:
  serviceConnection: ''
  terraformstoragerg: ''
  terraformstorageaccount: ''
  variables:
    tenantId: ''
    clientId: ''
    clientSecret: ''

steps:
- bash: |
   az login --service-principal --username ${{ parameters.variables.clientId }} --password ${{ parameters.variables.clientSecret }} --tenant ${{ parameters.variables.tenantId }}
   az storage container create --name terraform --account-name ${{ parameters.terraformstorageaccount }}
   STORAGEKEY=$(az storage account keys list --resource-group ${{ parameters.terraformstorageRG }} --account-name ${{ parameters.terraformstorageaccount }} --query "[0].value" | tr -d '"')
   echo "##vso[task.setvariable variable=storagekey;isOutput=true]$STORAGEKEY"
  displayName: getStorageKey
